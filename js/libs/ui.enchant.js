enchant.ui={assets:["pad.png","apad.png","icon0.png","font0.png"]};enchant.ui.Pad=enchant.Class.create(enchant.Sprite,{initialize:function(){var a=enchant.Core.instance;var b=a.assets["pad.png"];enchant.Sprite.call(this,b.width/2,b.height);this.image=b;this.input={left:false,right:false,up:false,down:false};this.addEventListener("touchstart",function(c){this._updateInput(this._detectInput(c.localX,c.localY));});this.addEventListener("touchmove",function(c){this._updateInput(this._detectInput(c.localX,c.localY));});this.addEventListener("touchend",function(c){this._updateInput({left:false,right:false,up:false,down:false});});},_detectInput:function(a,c){a-=this.width/2;c-=this.height/2;var b={left:false,right:false,up:false,down:false};if(a*a+c*c>200){if(a<0&&c<a*a*0.1&&c>a*a*-0.1){b.left=true;}if(a>0&&c<a*a*0.1&&c>a*a*-0.1){b.right=true;}if(c<0&&a<c*c*0.1&&a>c*c*-0.1){b.up=true;}if(c>0&&a<c*c*0.1&&a>c*c*-0.1){b.down=true;}}return b;},_updateInput:function(b){var a=enchant.Core.instance;["left","right","up","down"].forEach(function(c){if(this.input[c]&&!b[c]){a.changeButtonState(c,false);}if(!this.input[c]&&b[c]){a.changeButtonState(c,true);}},this);this.input=b;}});enchant.ui.APad=enchant.Class.create(enchant.Group,{initialize:function(g){var b=enchant.Core.instance;var e=b.assets["apad.png"];var a=this.width=e.width;var d=this.height=e.height;enchant.Group.call(this);this.outside=new enchant.Sprite(a,d);var f=new enchant.Surface(a,d);f.draw(e,0,0,a,d/4,0,0,a,d/4);f.draw(e,0,d/4*3,a,d/4,0,d/4*3,a,d/4);f.draw(e,0,d/4,a/4,d/2,0,d/4,a/4,d/2);f.draw(e,a/4*3,d/4,a/4,d/2,a/4*3,d/4,a/4,d/2);this.outside.image=f;this.inside=new enchant.Sprite(a/2,d/2);var c=new enchant.Surface(a/2,d/2);c.draw(e,a/4,d/4,a/2,d/2,0,0,a/2,d/2);this.inside.image=c;this.r=a/2;this.isTouched=false;this.vx=0;this.vy=0;this.rad=0;this.dist=0;if(g==="direct"){this.mode="direct";}else{this.mode="normal";}this._updateImage();this.addChild(this.inside);this.addChild(this.outside);this.addEventListener("touchstart",function(h){this._detectInput(h.localX,h.localY);this._calcPolar(h.localX,h.localY);this._updateImage(h.localX,h.localY);this._dispatchPadEvent("apadstart");this.isTouched=true;});this.addEventListener("touchmove",function(h){this._detectInput(h.localX,h.localY);this._calcPolar(h.localX,h.localY);this._updateImage(h.localX,h.localY);this._dispatchPadEvent("apadmove");});this.addEventListener("touchend",function(h){this._detectInput(this.width/2,this.height/2);this._calcPolar(this.width/2,this.height/2);this._updateImage(this.width/2,this.height/2);this._dispatchPadEvent("apadend");this.isTouched=false;});},_dispatchPadEvent:function(a){var b=new enchant.Event(a);b.vx=this.vx;b.vy=this.vy;b.rad=this.rad;b.dist=this.dist;this.dispatchEvent(b);},_updateImage:function(a,b){a-=this.width/2;b-=this.height/2;this.inside.x=this.vx*(this.r-10)+25;this.inside.y=this.vy*(this.r-10)+25;},_detectInput:function(b,f){b-=this.width/2;f-=this.height/2;var e=Math.sqrt(b*b+f*f);var d=f/b;var a=Math.atan(d);var c=b/Math.abs(b);if(e===0){this.vx=0;this.vy=0;}else{if(b===0){this.vx=0;if(this.mode==="direct"){this.vy=(f/this.r);}else{c=f/Math.abs(f);this.vy=Math.pow((f/this.r),2)*c;}}else{if(e<this.r){if(this.mode==="direct"){this.vx=(b/this.r);this.vy=(f/this.r);}else{this.vx=Math.pow((e/this.r),2)*Math.cos(a)*c;this.vy=Math.pow((e/this.r),2)*Math.sin(a)*c;}}else{this.vx=Math.cos(a)*c;this.vy=Math.sin(a)*c;}}}},_calcPolar:function(b,e){b-=this.width/2;e-=this.height/2;var c=0;var a=0;var d=Math.sqrt(b*b+e*e);if(d>this.r){d=this.r;}d/=this.r;if(this.mode==="normal"){d*=d;}if(b>=0&&e<0){c=Math.PI/2*3;a=b/e;}else{if(b<0&&e<=0){c=Math.PI;a=e/b;}else{if(b<=0&&e>0){c=Math.PI/2;a=b/e;}else{if(b>0&&e>=0){c=0;a=e/b;}}}}if(b===0||e===0){a=0;}this.rad=Math.abs(Math.atan(a))+c;this.dist=d;}});enchant.ui.Button=enchant.Class.create(enchant.Entity,{initialize:function(e,d,a,c){enchant.Entity.call(this);if(enchant.CanvasLayer){this._element="div";}this.width=c||null;this.height=a||null;this.text=e;this.pressed=false;var b=this._style;b.display="inline-block";b["font-size"]="12px";b.height="2em";b["line-height"]="2em";b["min-width"]="2em";b.padding="2px 10px";b["text-align"]="center";b["font-weight"]="bold";b["border-radius"]="0.5em";d=d||"dark";if(typeof d==="string"){this.theme=enchant.ui.Button.DEFAULT_THEME[d];}else{this.theme=d;}this._applyTheme(this.theme.normal);this.addEventListener("touchstart",function(){this._applyTheme(this.theme.active);this.pressed=true;this.y++;});this.addEventListener("touchend",function(){this._applyTheme(this.theme.normal);this.pressed=false;this.y--;});},_applyTheme:function(d){var c=this._style;var b=enchant.ui.Button.theme2css(d);for(var a in b){if(b.hasOwnProperty(a)){c[a]=b[a];}}},text:{get:function(){return this._text;},set:function(a){this._text=a;if(!enchant.CanvasLayer){this._element.innerHTML=a;}}},size:{get:function(){return this._style.fontSize;},set:function(a){this._style.fontSize=a;}},font:{get:function(){return this._style.font;},set:function(a){this._style.font=a;}},color:{get:function(){return this._style.color;},set:function(a){this._style.color=a;}},cvsRender:function(){},domRender:function(){var a=this._domManager.element;a.innerHTML=this._text;a.style.font=this._font;a.style.color=this._color;a.style.textAlign=this._textAlign;}});enchant.ui.Button.theme2css=function(g){var e="-"+enchant.ENV.VENDOR_PREFIX.toLowerCase()+"-";var f={};var b=g.background;var d=g.border;var c=g.textShadow;var a=g.boxShadow;if(e==="-ms-"){f.background=b.start;}else{f["background-image"]=e+b.type+"("+["top",b.start,b.end]+")";}f.color=g.color;f.border=d.color+" "+d.width+" "+d.type;f["text-shadow"]=c.offsetX+"px "+c.offsetY+"px "+c.blur+" "+c.color;f["box-shadow"]=a.offsetX+"px "+a.offsetY+"px "+a.blur+" "+a.color;return f;};enchant.ui.Button.DEFAULT_THEME={dark:{normal:{color:"#fff",background:{type:"linear-gradient",start:"#666",end:"#333"},border:{color:"#333",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#666"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(255, 255, 255, 0.3)"}},active:{color:"#ccc",background:{type:"linear-gradient",start:"#333",end:"#000"},border:{color:"#333",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#000"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(255, 255, 255, 0.3)"}}},light:{normal:{color:"#333",background:{type:"linear-gradient",start:"#fff",end:"#ccc"},border:{color:"#999",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#fff"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(0, 0, 0, 1)"},},active:{color:"#333",background:{type:"linear-gradient",start:"#ccc",end:"#999"},border:{color:"#666",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#ccc"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(255, 255, 255, 0.3)"}}},blue:{normal:{color:"#fff",background:{type:"linear-gradient",start:"#04f",end:"#04c"},border:{color:"#026",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#666"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(0, 0, 0, 0.5)"}},active:{color:"#ccc",background:{type:"linear-gradient",start:"#029",end:"#026"},border:{color:"#026",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#000"},boxShadow:"none"}}};enchant.ui.MutableText=enchant.Class.create(enchant.Sprite,{initialize:function(a,c,b){enchant.Sprite.call(this,0,0);this.fontSize=16;this.widthItemNum=16;this.x=a;this.y=c;this._imageAge=Number.MAX_VALUE;this.text="";if(arguments[2]){this.row=Math.floor(arguments[2]/this.fontSize);}},setText:function(b){var d,a,h,e,c,g;this._text=b;var f;if(!this.returnLength){this.width=Math.min(this.fontSize*this._text.length,enchant.Game.instance.width);}else{this.width=Math.min(this.returnLength*this.fontSize,enchant.Game.instance.width);}this.height=this.fontSize*(Math.ceil(this._text.length/this.row)||1);if(!this.image||this.width>this.image.width||this.height>this.image.height||this._imageAge>300){this.image=new enchant.Surface(this.width,this.height);this._imageAge=0;}else{if(this.width<this.image.width||this.height<this.image.height){this._imageAge++;}else{this._imageAge=0;}}this.image.context.clearRect(0,0,this.width,this.height);for(d=0;d<b.length;d++){c=b.charCodeAt(d);if(c>=32&&c<=127){g=c-32;}else{g=0;}a=g%this.widthItemNum;h=(g/this.widthItemNum)|0;this.image.draw(enchant.Game.instance.assets["font0.png"],a*this.fontSize,h*this.fontSize,this.fontSize,this.fontSize,(d%this.row)*this.fontSize,((d/this.row)|0)*this.fontSize,this.fontSize,this.fontSize);}},text:{get:function(){return this._text;},set:function(a){this.setText(a);}},row:{get:function(){return this.returnLength||this.width/this.fontSize;},set:function(a){this.returnLength=a;this.text=this.text;}}});enchant.ui.ScoreLabel=enchant.Class.create(enchant.ui.MutableText,{initialize:function(a,b){enchant.ui.MutableText.call(this,0,0);switch(arguments.length){case 2:this.y=b;this.x=a;break;case 1:this.x=a;break;default:break;}this._score=0;this._current=0;this.easing=2.5;this.text=this.label="SCORE:";this.addEventListener("enterframe",function(){if(this.easing===0){this.text=this.label+(this._current=this._score);}else{var c=this._score-this._current;if(0<c){this._current+=Math.ceil(c/this.easing);}else{if(c<0){this._current+=Math.floor(c/this.easing);}}this.text=this.label+this._current;}});},score:{get:function(){return this._score;},set:function(a){this._score=a;}}});enchant.ui.TimeLabel=enchant.Class.create(enchant.ui.MutableText,{initialize:function(b,c,a){enchant.ui.MutableText.call(this,0,0);switch(arguments.length){case 3:case 2:this.y=c;this.x=b;break;case 1:this.x=b;break;default:break;}this._time=0;this._count=1;if(a==="countdown"){this._count=-1;}this.text=this.label="TIME:";this.addEventListener("enterframe",function(){this._time+=this._count;this.text=this.label+(this._time/enchant.Game.instance.fps).toFixed(2);});},time:{get:function(){return Math.floor(this._time/enchant.Game.instance.fps);},set:function(a){this._time=a*enchant.Game.instance.fps;}}});enchant.ui.LifeLabel=enchant.Class.create(enchant.Group,{initialize:function(a,d,c){enchant.Group.call(this);this.x=a||0;this.y=d||0;this._maxlife=c||9;this._life=0;this.label=new enchant.ui.MutableText(0,0,80);this.label.text="LIFE:";this.addChild(this.label);this.heart=[];for(var b=0;b<this._maxlife;b++){this.heart[b]=new enchant.Sprite(16,16);this.heart[b].image=enchant.Game.instance.assets["icon0.png"];this.heart[b].x=this.label.width+b*16;this.heart[b].y=-3;this.heart[b].frame=10;this.addChild(this.heart[b]);}},life:{get:function(){return this._life;},set:function(b){this._life=b;if(this._maxlife<b){this._life=this._maxlife;}for(var a=0;a<this._maxlife;a++){this.heart[a].visible=(a<=b-1);}}}});enchant.ui.Bar=enchant.Class.create(enchant.Sprite,{initialize:function(a,b){enchant.Sprite.call(this,1,16);this.image=new enchant.Surface(1,16);this.image.context.fillColor="RGB(0, 0, 256)";this.image.context.fillRect(0,0,1,16);this._direction="right";this._origin=0;this._maxvalue=enchant.Game.instance.width;this._lastvalue=0;this.value=0;this.easing=5;switch(arguments.length){case 2:this.y=b;this.x=a;this._origin=a;break;case 1:this.x=a;this._origin=a;break;default:break;}this.addEventListener("enterframe",function(){if(this.value<0){this.value=0;}this._lastvalue+=(this.value-this._lastvalue)/this.easing;if(Math.abs(this._lastvalue-this.value)<1.3){this._lastvalue=this.value;}this.width=(this._lastvalue)|0;if(this.width>this._maxvalue){this.width=this._maxvalue;}if(this._direction==="left"){this._x=this._origin-this.width;}else{this._x=this._origin;}this._updateCoordinate();});},direction:{get:function(){return this._direction;},set:function(a){if(a!=="right"&&a!=="left"){}else{this._direction=a;}}},x:{get:function(){return this._origin;},set:function(a){this._x=a;this._origin=a;this._dirty=true;}},maxvalue:{get:function(){return this._maxvalue;},set:function(a){this._maxvalue=a;}}});enchant.ui.VirtualMap=enchant.Class.create(enchant.Group,{initialize:function(a,b){enchant.Group.call(this);this.meshWidth=a||16;this.meshHeight=b||16;},addChild:function(a){enchant.Group.prototype.addChild.call(this,a);this.bind(a);},insertBefore:function(b,a){enchant.Group.prototype.insertBefore.call(this,b,a);this.bind(b);},bind:function(a){Object.defineProperties(a,{mx:{get:function(){return Math.floor(this.x/this.parentNode.meshWidth);},set:function(b){this.x=Math.floor(b*this.parentNode.meshWidth);}},my:{get:function(){return Math.floor(this.y/this.parentNode.meshHeight);},set:function(b){this.y=Math.floor(b*this.parentNode.meshWidth);}}});a.mx=0;a.my=0;}});function rand(a){return Math.floor(Math.random()*a);}